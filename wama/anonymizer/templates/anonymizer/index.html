{% extends 'anonymizer/base.html' %}

{% load static %}

{% block title %}Anonymizer - Objects Blurring{% endblock %}

{% block javascript %}
{{ block.super }}
{# JQUERY FILE UPLOAD SCRIPTS #}
<script src="{% static 'js/jquery-file-upload/vendor/jquery.ui.widget.js' %}"></script>
<script src="{% static 'js/jquery-file-upload/jquery.iframe-transport.js' %}"></script>
<script src="{% static 'js/jquery-file-upload/jquery.fileupload.js' %}"></script>

{# MEDIAS PAGE SCRIPTS #}
<script src="{% static 'anonymizer/js/console.js' %}"></script>
<script src="{% static 'anonymizer/js/process.js' %}"></script>
<script src="{% static 'anonymizer/js/update.js' %}"></script>
<script src="{% static 'anonymizer/js/upload.js' %}"></script>
<script src="{% static 'anonymizer/js/settings_modal.js' %}"></script>

{# Fix modal z-index by moving modals to body level #}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Move all modals that start with "modal_classes2blur" to body level
        document.querySelectorAll('[id^="modal_classes2blur"]').forEach(function(modal) {
            document.body.appendChild(modal);
        });
    });
</script>
{% endblock %}

{% block anonymizer_content %}

<!-- Upload Zone -->
<div class="row mb-4">
    <div class="col-12">
        <div class="drop-zone" id="dropZoneAnonymizer">
            <i class="fas fa-cloud-upload-alt fa-3x mb-3 text-primary"></i>
            <h5 class="text-light">Glissez-déposez vos fichiers photo/vidéo ici</h5>
            <p class="text-light mb-3">ou cliquez pour parcourir</p>
            <p class="small text-white-50">
                Photo: JPG, PNG, GIF, BMP, WEBP<br>
                Vidéo: MP4, AVI, MKV, MOV, WEBM
            </p>
            <input id="fileupload" type="file" name="file" multiple
                   accept="image/*,video/*"
                   style="display: none;"
                   data-url="{% url 'anonymizer:upload' %}"
                   data-form-data='{"csrfmiddlewaretoken": "{{ csrf_token }}"}'>
            <button type="button" class="btn btn-primary mt-2 js-upload-medias">
                <i class="fas fa-folder-open"></i> Parcourir
            </button>
        </div>
    </div>
</div>

<!-- URL Upload Section -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card bg-dark border-secondary">
            <div class="card-body">
                <h6 class="text-light mb-3">
                    <i class="fas fa-link"></i> Télécharger depuis une URL
                </h6>
                <form id="media-url-form" method="post" enctype="multipart/form-data" action="{% url 'anonymizer:upload' %}">
                    {% csrf_token %}
                    <div class="input-group">
                        <input type="text"
                               class="form-control bg-dark text-white border-secondary"
                               id="media_url"
                               name="media_url"
                               placeholder="Collez l'URL de la photo/vidéo ici..."
                               aria-label="Media URL">
                        <button class="btn btn-primary" type="submit">
                            <i class="fas fa-download"></i> Télécharger
                        </button>
                    </div>
                    <small class="text-white-50 mt-2 d-block">
                        Exemple: https://example.com/video.mp4 ou lien YouTube
                    </small>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Main Content Container -->
<div id="main_container">
    {% include "anonymizer/upload/content.html" %}
</div>
{% endblock %}

{% block extra_modals %}
<!--  Progress popup - Must be at body level for proper z-index -->
<div class="modal fade" id="modal-progress" tabindex="-1" aria-labelledby="modalProgressLabel">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title text-white" id="modalProgressLabel">
                    <i class="fas fa-upload me-2"></i>Téléchargement en cours...
                </h4>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="progress" style="height: 24px;">
                    <div class="progress-bar progress-bar-striped progress-bar-animated"
                         role="progressbar"
                         style="width: 0%;"
                         aria-valuenow="0"
                         aria-valuemin="0"
                         aria-valuemax="100">0%</div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-1"></i>Fermer
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
