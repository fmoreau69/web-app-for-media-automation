<hr>
<div class="row mb-3">
    <div class="col-3 d-flex justify-content-left"></div>
    <div class="col-6">
        <h2 class="text-center">Global Settings</h2>
    </div>
    <div class="col-3">
        <form method="post" action="{% url 'anonymizer:reset_user_settings' %}" class="ajax-form"
              data-target="#global_settings_container">
            {% csrf_token %}
            <input type="hidden" class="reset-button" name="next" value="{{ request.path }}">
            <button type="submit" class="btn btn-danger float-end">
                <i class="fas fa-rotate-left"></i> Reset Settings
            </button>
        </form>
    </div>
</div>

<table id="options" class="table table-bordered">
    <thead>
    <tr>
        <td class="fw-bold text-center text-bg-secondary">What to blur ?</td>
        <td class="fw-bold text-center text-bg-secondary">How to blur ?</td>
        <td class="fw-bold text-center text-bg-secondary">What to show ?</td>
    </tr>
    </thead>
</table>

<div class="row">
    <!-- What to blur (col-4) -->
    <div class="col-4 d-flex flex-column align-items-center">
        {% for setting in global_settings %}
            {% if setting.label == 'WTB' %}
                {% if setting.name == 'classes2blur' %}
                    {% include "widgets/CheckboxMultipleModal.html" with field=user_settings_form.classes2blur id=user.id setting_type='user_setting' value=gs_values|get_value:setting.name button_width=4 %}

                    <!-- Precision Level Slider -->
                    <div class="mt-4 mb-3" style="width: 100%; max-width: 320px;">
                        <label class="form-label fw-bold text-center d-block mb-2">Processing Mode</label>
                        <div class="d-flex align-items-center gap-2">
                            <span class="text-muted small" style="min-width: 45px;">Quick</span>
                            <div style="flex: 1;">
                                <input class="form-range setting-button" type="range"
                                       name="precision_level"
                                       id="user_setting_precision_level"
                                       value="{% if gs_values.precision_level %}{{ gs_values.precision_level }}{% else %}50{% endif %}"
                                       min="0" max="100" step="5"
                                       title="Processing precision level"
                                       oninput="updatePrecisionLabel(this)">
                                <div class="text-center mt-1">
                                    <small class="text-info" id="precision_label">
                                        {% if gs_values.precision_level <= 20 %}Quick (n)
                                        {% elif gs_values.precision_level <= 40 %}Balanced Quick (s)
                                        {% elif gs_values.precision_level <= 60 %}Balanced (m)
                                        {% elif gs_values.precision_level <= 80 %}Balanced Precise (l)
                                        {% else %}Maximum Precision (x){% endif %}
                                    </small>
                                </div>
                            </div>
                            <span class="text-muted small" style="min-width: 55px;">Precise</span>
                        </div>
                        <div class="text-center mt-2">
                            <small class="text-muted">
                                <i class="fas fa-info-circle"></i> Adjusts model size and segmentation
                            </small>
                        </div>
                    </div>

                    <div class="mt-3" style="width: 100%; max-width: 320px;">
                        <select id="user_setting_model_to_use" class="form-select setting-button">
                            <option value="">Auto (based on precision)</option>
                            {% for model_type, model_list in models_by_type.items %}
                                {% if model_type == 'detect' %}
                                    <optgroup label="Detection">
                                {% elif model_type == 'segment' %}
                                    <optgroup label="Segmentation">
                                {% elif model_type == 'classify' %}
                                    <optgroup label="Classification">
                                {% elif model_type == 'pose' %}
                                    <optgroup label="Pose Estimation">
                                {% elif model_type == 'obb' %}
                                    <optgroup label="Oriented Bounding Box">
                                {% elif model_type == 'root' %}
                                    <optgroup label="Legacy (Root Directory)">
                                {% else %}
                                    <optgroup label="{{ model_type|title }}">
                                {% endif %}
                                    {% for model_name in model_list %}
                                        {% if model_type == 'root' %}
                                            <option value="{{ model_name }}" {% if gs_values.model_to_use == model_name %}selected{% endif %}>{{ model_name }}</option>
                                        {% else %}
                                            <option value="{{ model_type }}/{{ model_name }}" {% if gs_values.model_to_use == model_name or gs_values.model_to_use|stringformat:'s' == model_type|add:'/'|add:model_name %}selected{% endif %}>{{ model_name }}</option>
                                        {% endif %}
                                    {% endfor %}
                                </optgroup>
                            {% endfor %}
                        </select>
                        <label class="form-label fw-bold" for="user_setting_model_to_use">Model to use (optional)</label>
                    </div>
                {% endif %}
            {% endif %}
        {% endfor %}
    </div>

    <script>
    function updatePrecisionLabel(slider) {
        const value = parseInt(slider.value);
        const label = document.getElementById('precision_label');

        if (value <= 20) {
            label.textContent = 'Quick (n)';
            label.className = 'text-success';
        } else if (value <= 40) {
            label.textContent = 'Balanced Quick (s)';
            label.className = 'text-info';
        } else if (value <= 60) {
            label.textContent = 'Balanced (m)';
            label.className = 'text-primary';
        } else if (value <= 80) {
            label.textContent = 'Balanced Precise (l)';
            label.className = 'text-warning';
        } else {
            label.textContent = 'Maximum Precision (x)';
            label.className = 'text-danger';
        }
    }
    </script>

    <!-- How to blur (col-4) -->
    <div class="col-4 d-flex flex-column align-items-center">
        <div>
        {% for setting in global_settings %}
            {% if setting.label == 'HTB' %}
                {% include 'anonymizer/upload/setting_button.html' with id=user.id setting_type='user_setting' value=gs_values|get_value:setting.name range_width='col-sm-3' %}
            {% endif %}
        {% endfor %}
        </div>
    </div>

    <!-- What to show (col-4) -->
    <div class="col-4 d-flex flex-column">
        {% for setting in global_settings %}
            {% if setting.label == 'WTS' %}
                {% include 'anonymizer/upload/setting_button.html' with id=user.id setting_type='user_setting' value=gs_values|get_value:setting.name range_width='col-sm-3' %}
            {% endif %}
        {% endfor %}
    </div>
</div>
<br>
